<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Kisti Dashboard (Year Wise)</title>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
      body {
        font-family: Arial, sans-serif;
        background: #f3f4f6;
        padding: 30px;
      }

      h1 {
        text-align: center;
      }

      .filters {
        display: flex;
        gap: 20px;
        justify-content: center;
        margin: 20px 0;
      }

      select {
        padding: 8px 12px;
        font-size: 16px;
      }

      table {
        width: 100%;
        border-collapse: collapse;
        background: #fff;
        margin-top: 20px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.08);
      }

      th,
      td {
        border: 1px solid #ddd;
        padding: 10px;
        text-align: center;
      }

      th {
        background: #2563eb;
        color: white;
      }

      .paid {
        color: green;
        font-weight: bold;
      }
      .unpaid {
        color: red;
        font-weight: bold;
      }

      .charts {
        display: flex;
        gap: 30px;
        margin-top: 40px;
        flex-wrap: wrap;
        justify-content: center;
      }

      canvas {
        background: #fff;
        padding: 20px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      }

      @media print {
        .filters {
          display: none;
        }
      }
    </style>
  </head>
  <body>
    <h1>Kisti Payment Dashboard</h1>

    <div class="filters">
      <select id="yearFilter"></select>
      <select id="monthFilter"></select>
    </div>

    <div id="tableContainer"></div>

    <div class="charts">
      <canvas id="barChart" width="350" height="280"></canvas>
      <canvas id="pieChart" width="350" height="280"></canvas>
    </div>

    <script>
      // ðŸ”¹ Year â†’ Month â†’ Payments data
      const paymentData = [
        {
          year: 2026,
          months: [
            {
              month: "January",
              payments: [
                { name: "Mobin", amount: 2000, paid: false },
                { name: "Shawon", amount: 2000, paid: false },
                { name: "Siam", amount: 2000, paid: false },
                { name: "Rimon", amount: 2000, paid: false },
                { name: "Shanto", amount: 2000, paid: false },
                { name: "Fahim", amount: 2000, paid: false },
                { name: "Rishad", amount: 2000, paid: false },
              ],
            },
            // {
            //   month: "February",
            //   payments: [
            //     { name: "Rahim", amount: 2000, paid: true },
            //     { name: "Karim", amount: 2000, paid: true },
            //   ],
            // },
          ],
        },
        // {
        //   year: 2025,
        //   months: [
        //     {
        //       month: "January",
        //       payments: [
        //         { name: "Rahim", amount: 2500, paid: true },
        //         { name: "Karim", amount: 2500, paid: true },
        //       ],
        //     },
        //   ],
        // },
      ];

      const yearFilter = document.getElementById("yearFilter");
      const monthFilter = document.getElementById("monthFilter");
      const tableContainer = document.getElementById("tableContainer");

      let barChart, pieChart;

      // Populate years
      paymentData.forEach((y) => {
        yearFilter.innerHTML += `<option value="${y.year}">${y.year}</option>`;
      });

      function populateMonths(year) {
        monthFilter.innerHTML = `<option value="all">All Months</option>`;
        const yearData = paymentData.find((y) => y.year == year);
        yearData.months.forEach((m) => {
          monthFilter.innerHTML += `<option value="${m.month}">${m.month}</option>`;
        });
      }

      function render(year, month) {
        tableContainer.innerHTML = "";
        let totalPaid = 0;
        let totalDue = 0;

        const yearData = paymentData.find((y) => y.year == year);

        yearData.months
          .filter((m) => month === "all" || m.month === month)
          .forEach((m) => {
            let html = `
          <h2>${m.month} (${year})</h2>
          <table>
            <tr>
              <th>Name</th>
              <th>Amount</th>
              <th>Status</th>
            </tr>
        `;

            m.payments.forEach((p) => {
              if (p.paid) totalPaid += p.amount;
              else totalDue += p.amount;

              html += `
            <tr>
              <td>${p.name}</td>
              <td>${p.amount}</td>
              <td class="${p.paid ? "paid" : "unpaid"}">
                ${p.paid ? "Paid" : "Not Paid"}
              </td>
            </tr>
          `;
            });

            html += `</table>`;
            tableContainer.innerHTML += html;
          });

        updateCharts(totalPaid, totalDue);
      }

      function updateCharts(paid, due) {
        if (barChart) barChart.destroy();
        if (pieChart) pieChart.destroy();

        barChart = new Chart(barChartEl, {
          type: "bar",
          data: {
            labels: ["Paid", "Due"],
            datasets: [
              {
                label: "Amount (Tk)",
                data: [paid, due],
                backgroundColor: ["#22c55e", "#ef4444"],
              },
            ],
          },
        });

        pieChart = new Chart(pieChartEl, {
          type: "pie",
          data: {
            labels: ["Paid", "Due"],
            datasets: [
              {
                data: [paid, due],
                backgroundColor: ["#22c55e", "#ef4444"],
              },
            ],
          },
        });
      }

      const barChartEl = document.getElementById("barChart");
      const pieChartEl = document.getElementById("pieChart");

      yearFilter.addEventListener("change", (e) => {
        populateMonths(e.target.value);
        render(e.target.value, "all");
      });

      monthFilter.addEventListener("change", (e) => {
        render(yearFilter.value, e.target.value);
      });

      // Initial load
      yearFilter.value = paymentData[0].year;
      populateMonths(paymentData[0].year);
      render(paymentData[0].year, "all");
    </script>
  </body>
</html>
